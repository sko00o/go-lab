package main

import (
	"net"
	"time"

	"github.com/tatsushid/go-fastping"
	"go.uber.org/zap"
)

var sugar *zap.SugaredLogger

func main() {
	// make logger
	sugar = zap.NewExample().Sugar()
	defer sugar.Sync()
	// init a pinger
	pinger := fastping.NewPinger()
	// map ip addr to name
	m := make(map[string]string)

	resolve := func(addr, name string) {
		ra, err := net.ResolveIPAddr("ip4:icmp", addr)
		if err != nil {
			sugar.Error(err)
			return
		}

		pinger.AddIPAddr(ra)
		m[addr] = name
	}

	for _, d := range dnsList {
		if addr := d.Addr1; addr != "" {
			resolve(addr, d.Name)
		}
		if addr := d.Addr2; addr != "" {
			resolve(addr, d.Name)
		}
	}

	pinger.OnRecv = func(addr *net.IPAddr, rtt time.Duration) {
		sugar.With("addr", addr, "name", m[addr.String()]).Info("RTT=", rtt)
	}

	if err := pinger.Run(); err != nil {
		sugar.Error(err)
	}
}

type DNSServer struct {
	Name         string
	Addr1, Addr2 string
}

var dnsList = []DNSServer{
	{"114 DNS", "114.114.114.114", "114.114.115.115"},
	{"阿里 AliDNS", "223.5.5.5", "223.6.6.6"},
	{"百度 BaiduDNS", "180.76.76.76", ""},
	{"DNSPod DNS+", "119.29.29.29", "182.254.116.116"},
	{"CNNIC SDNS", "1.2.4.8", "210.2.4.8"},
	{"oneDNS", "117.50.11.11", "52.80.66.66"},
	{"DNS 派, 电信/移动/铁通", "101.226.4.6", "218.30.118.6"},
	{"DNS 派 联通", "123.125.81.6", "140.207.198.6"},
	{"Cloudflare DNS", "1.1.1.1", "1.0.0.1"},
	{"Google DNS", "8.8.8.8", "8.8.4.4"},
	{"IBM Quad9", "9.9.9.9", ""},
	{"DNS.SB", "185.222.222.222", "185.184.222.222"},
	{"OpenDNS", "208.67.222.222", "208.67.220.220"},
	{"V2EX DNS", "199.91.73.222", "178.79.131.110"},

	{"安徽电信 DNS", "61.132.163.68", "202.102.213.68"},
	{"北京电信 DNS", "219.141.136.10", "219.141.140.10"},
	{"重庆电信 DNS", "61.128.192.68", "61.128.128.68"},
	{"福建电信 DNS", "218.85.152.99", "218.85.157.99"},
	{"甘肃电信 DNS", "202.100.64.68", "61.178.0.93"},
	{"广东电信 DNS", "202.96.128.86", "202.96.128.166"},
	{"广东电信 DNS2", "202.96.134.33", "202.96.128.68"},
	{"广西电信 DNS", "202.103.225.68", "202.103.224.68"},
	{"贵州电信 DNS", "202.98.192.67", "202.98.198.167"},
	{"河南电信 DNS", "222.88.88.88", "222.85.85.85"},
	{"黑龙江电信", "219.147.198.230", "219.147.198.242"},
	{"湖北电信 DNS", "202.103.24.68", "202.103.0.68"},
	{"湖南电信 DNS", "222.246.129.80", "59.51.78.211"},
	{"江苏电信 DNS", "218.2.2.2", "218.4.4.4"},
	{"江苏电信 DNS2", "61.147.37.1", "218.2.135.1"},
	{"江西电信 DNS", "202.101.224.69", "202.101.226.68"},
	{"内蒙古电信", "219.148.162.31", "222.74.39.50"},
	{"山东电信 DNS", "219.146.1.66", "219.147.1.66"},
	{"陕西电信 DNS", "218.30.19.40", "61.134.1.4"},
	{"上海电信 DNS", "202.96.209.133", "116.228.111.118"},
	{"上海电信 DNS2", "202.96.209.5", "180.168.255.118"},
	{"四川电信 DNS", "61.139.2.69", "218.6.200.139"},
	{"天津电信 DNS", "219.150.32.132", "219.146.0.132"},
	{"云南电信 DNS", "222.172.200.68", "61.166.150.123"},
	{"浙江电信 DNS", "202.101.172.35", "61.153.177.196"},
	{"浙江电信 DNS2", "61.153.81.75", "60.191.244.5"},

	{"北京联通 DNS", "123.123.123.123", "123.123.123.124"},
	{"北京联通 DNS2", "202.106.0.20", "202.106.195.68"},
	{"重庆联通 DNS", "221.5.203.98", "221.7.92.98"},
	{"广东联通 DNS", "210.21.196.6", "221.5.88.88"},
	{"河北联通 DNS", "202.99.160.68", "202.99.166.4"},
	{"河南联通 DNS", "202.102.224.68", "202.102.227.68"},
	{"黑龙江联通", "202.97.224.69", "202.97.224.68"},
	{"吉林联通 DNS", "202.98.0.68", "202.98.5.68"},
	{"江苏联通 DNS", "221.6.4.66", "221.6.4.67"},
	{"内蒙古联通", "202.99.224.68", "202.99.224.8"},
	{"山东联通 DNS", "202.102.128.68", "202.102.152.3"},
	{"山东联通 DNS2", "202.102.134.68", "202.102.154.3"},
	{"山西联通 DNS", "202.99.192.66", "202.99.192.68"},
	{"陕西联通 DNS", "221.11.1.67", "221.11.1.68"},
	{"上海联通 DNS", "210.22.70.3", "210.22.84.3"},
	{"四川联通 DNS", "119.6.6.6", "124.161.87.155"},
	{"天津联通 DNS", "202.99.104.68", "202.99.96.68"},
	{"浙江联通 DNS", "221.12.1.227", "221.12.33.227"},
	{"辽宁联通 DNS", "202.96.69.38", "202.96.64.68"},

	{"江苏移动 DNS", "221.131.143.69", "112.4.0.55"},
	{"安徽移动 DNS", "211.138.180.2", "211.138.180.3"},
	{"山东移动 DNS", "218.201.96.130", "211.137.191.26"},
	{"上海移动 DNS", "211.136.150.66", "211.136.112.50"},
	{"浙江移动 DNS", "211.140.13.188", "211.140.188.188"},
	{"江西移动 DNS", "211.141.90.68", "211.141.85.68"},
	{"四川移动 DNS", "211.137.82.4", ""},
}
